{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load mathfilters %}
{# % load restaurant_filters % #}

{% block custom__header %}
  <meta http-equiv="refresh" content="10; URL=">
  <title>お客様お会計</title>
{% endblock %}

{% block content %}
<div class="w-100 restaurant">
  {% include 'components/restaurant/header.html' %}
  <section class="pt-5 total">
    <div class="pt-sm-3 pt-5">
      <p class="text-sm-left text-center pt-sm-3 pl-sm-3">＊このページは10秒毎に自動で再読み込みします</p>
      <div class="table-list py-5 mx-4">

        <div class="pb-4 text__bold text-center">
          <p class="text__large pb-3">利用中のテーブルお会計終了ボタン</p>
          <p class="text__underline">お会計の終了時に必ずタッチしてください</p>
        </div>
        <div class="d-flex pt-3 pb-5 justify-content-center align-items-center flex-wrap">
          {% for active_table in active_table_list %}
            <form action="{% url 'restaurant:stop_user_order' %}" class="mx-3" method="POST">{% csrf_token %}
              <button class="badge__red badge-table my-sm-0 mx-3 my-3 p-3 shadow text__bold">
                {{ active_table }} 番
                <!-- hidden -->
                <input type="hidden" name="active_table" value="{{ active_table }}">
              </button>
            </form>
            {% empty %}
            <p>なし</p>
          {% endfor %}
        </div>

        <div class="px-3">
          <p class="text__bold text__large text-center">合計（すでに調理・提供済みのメニューの合計金額）</p>
          <table border="1" class="w-100 my-3">
            <tr class="text-center">
              <th>テーブル番号</th>
              <th>合計（円）</th>
            </tr>
            {% for key, value in active_table_price_list.items %}
              <tr class="text-right">
                <td class="px-sm-3 px-2">{{ key }}</td>
                <td class="px-sm-3 px-2">{{ value | intcomma }}</td>
              </tr>
            {% empty %}
              <tr class="text-right">
                <td class="px-sm-3 px-2">なし</td>
                <td class="px-sm-3 px-2">なし</td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>

      <div>
        <p class="text__bold text__large text-center pt-5 pb-3">テーブル毎詳細</p>
        <hr>
        {% regroup orders by customer.table as table_list %}
        {% for table in table_list %}
          <div class="mx-4 my-3">
            <div class="d-flex justify-content-around pb-4">
              <p class="text__bold pb-3">テーブル番号： {{ table.grouper }}</p>
            </div>
            <table border="1" class="w-100">
              <tr class="text-center">
                <th>料理名</th>
                <th>単価（円）</th>
                <th>個数</th>
                <th>状況</th>
                <th>小計（円）</th>
              </tr>
              {% for order in table.list %}
                <tr>
                  <td class="px-sm-3 px-2">{{ order.menu }}</td>
                  <td class="text-right px-sm-3 px-2">{{ order.menu.price | intcomma }}</td>
                  <td class="text-right px-sm-3 px-2">{{ order.num }}</td>
                  <td class="px-sm-3 px-2">{{ order.status }}</td>
                  <td class="text-right px-sm-3 px-2">{{ order.menu.price|mul:order.num | intcomma }}</td>
                </tr>
              {% endfor %}
            </table>
            <!-- <p class="text__bold text__large text-right pt-3">合計：　
            </p> -->
          </div>
        <hr />
        {% endfor %}
      </div>
    </div>
  </section>
</div>
{% endblock %}
